module.exports = {

  beforeHandler: function(messageObj, session, send, finished) {
    if (messageObj.type === 'login') return;

    if (!session.authenticated) {
      finished({error: 'You must be logged in'});
      return false;
    }
  },

  handlers: {
    test: function(messageObj, session, send, finished) {
      console.log('*** session = ' + JSON.stringify(session));

      session.date = new Date().getTime();
      session.xxx = 'Test data';
      session.makeSecret('xxx');
      var incomingText = messageObj.params.text;
      finished({text: 'You sent: ' + incomingText});
    },
    login: function(messageObj, session, send, finished) {

      var username = messageObj.params.username;
      var password = messageObj.params.password;
      if (username === 'rob' && password === 'secret') {
        session.userText = 'Rob';
        session.username = username;
        session.authenticated = true;

        session.makeSecret('username');
        session.makeSecret('authenticated');

        return finished({ok: true});
      }
      else {
        return finished({error: 'Invalid login'});
      }
    }
  },

  workerResponseHandlers: {
    test: function(message, send) {
      // send a message to all currently-connected browsers
      this.io.toAll({test: 'message 2'});
      return message;
    }
  }

};